(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".disabled{pointer-events:none}.animate-spin{animation:spin 1s linear infinite}.download-header{margin:0;background:0}.grey path{fill:#bdcbdb}.has-background-primary .grey path{fill:#fff}.download-icon{height:100%;padding:.75rem;border:none;background:none!important;outline:none}.progress-text{font-size:.75rem;font-weight:600}.flex{display:flex}.mb-6{margin-bottom:1.5rem}.ms-auto{margin-inline-start:auto}.space-between{justify-content:space-between}.items-center{align-items:center}.downloaded path{fill:#5cb85c}.has-background-primary .downloaded path{fill:#7be57b}.failed path{fill:#ec5b56!important}.has-background-primary .failed path{fill:#6b1717!important}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}")),document.head.appendChild(e)}}catch(n){console.error("vite-plugin-css-injected-by-js",n)}})();
(function(L){typeof define=="function"&&define.amd?define(L):L()})(function(){"use strict";var ur=Object.defineProperty;var fr=(L,M,D)=>M in L?ur(L,M,{enumerable:!0,configurable:!0,writable:!0,value:D}):L[M]=D;var Ze=(L,M,D)=>(fr(L,typeof M!="symbol"?M+"":M,D),D),bt=(L,M,D)=>{if(!M.has(L))throw TypeError("Cannot "+D)};var X=(L,M,D)=>(bt(L,M,"read from private field"),D?D.call(L):M.get(L)),qe=(L,M,D)=>{if(M.has(L))throw TypeError("Cannot add the same private member more than once");M instanceof WeakSet?M.add(L):M.set(L,D)},V=(L,M,D,re)=>(bt(L,M,"write to private field"),re?re.call(L,D):M.set(L,D),D);var Je=(L,M,D,re)=>({set _(ge){V(L,M,ge,D)},get _(){return X(L,M,re)}});var W,ee,te;location.pathname=="/"||location.pathname.startsWith("/page")||location.pathname.startsWith("/favorites")?Promise.resolve().then(()=>nr).then(t=>t.init()):location.pathname.startsWith("/view/")?Promise.resolve().then(()=>sr).then(t=>t.init()):location.pathname.startsWith("/settings")&&Promise.resolve().then(()=>lr).then(t=>t.init());const L=(t,e)=>Array.from(e.querySelectorAll(".view-page-details tr")).find(n=>{var o,a;return(a=(o=n.querySelector("td"))==null?void 0:o.textContent)==null?void 0:a.includes(t)}),M=(t,e)=>{const r=L(t,e);if(r)return Array.from(r.querySelectorAll("a")).map(n=>n.childNodes[0].textContent.trim())},D=t=>{var S,d,f,g,w,E;const e=Number(t.querySelector('a[href^="/read/"]').getAttribute("href").split("/").at(-1)),r=t.querySelector("h1.title").textContent,n=(f=(d=(S=L("Description",t))==null?void 0:S.querySelector("td:last-of-type"))==null?void 0:d.textContent)==null?void 0:f.trim(),o=M("Artist",t),a=M("Circle",t),s=M("Magazine",t),i=M("Parody",t),c=M("Publisher",t),l=(E=(w=(g=L("Published",t))==null?void 0:g.querySelector("td:last-of-type"))==null?void 0:w.textContent)==null?void 0:E.trim(),u=(()=>{var b,T,A;const h=(A=(T=(b=L("Pages",t))==null?void 0:b.querySelector("td:last-of-type"))==null?void 0:T.textContent)==null?void 0:A.trim();if(h)return parseInt(h)})(),m=(()=>{var b,T,A;const h=(A=(T=(b=L("Favorites",t))==null?void 0:b.querySelector("td:last-of-type"))==null?void 0:T.textContent)==null?void 0:A.trim();if(h)return parseInt(h)})(),p=(()=>{var b;const h=(b=L("Tags",t))==null?void 0:b.querySelectorAll(".tag");if(h)return Array.from(h).map(T=>T.textContent.trim().split("(")[0].trim())})();return{id:e,title:r,description:n,artists:o,circles:a,magazines:s,parodies:i,publishers:c,published:l,pages:u,favorites:m,tags:p}},re=async t=>{const e=await fetch(`/view/${t}`);if(!e.ok)throw new Error(`[${e.status}] ${e.statusText} - Failed to get metadata for ${t}`);const r=await e.text(),n=new DOMParser().parseFromString(r,"text/html");return D(n)};var ge={},yt=function(t,e,r,n,o){var a=new Worker(ge[e]||(ge[e]=URL.createObjectURL(new Blob([t+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return a.onmessage=function(s){var i=s.data,c=i.$e$;if(c){var l=new Error(c[0]);l.code=c[1],l.stack=c[2],o(l,null)}else o(null,i)},a.postMessage(r,n),a},C=Uint8Array,P=Uint16Array,me=Int32Array,we=new C([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),be=new C([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ae=new C([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ve=function(t,e){for(var r=new P(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var o=new me(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)o[a]=a-r[n]<<5|n;return{b:r,r:o}},Ke=Ve(we,2),St=Ke.b,ye=Ke.r;St[28]=258,ye[258]=28;for(var Lt=Ve(be,0),De=Lt.r,Se=new P(32768),x=0;x<32768;++x){var K=(x&43690)>>1|(x&21845)<<1;K=(K&52428)>>2|(K&13107)<<2,K=(K&61680)>>4|(K&3855)<<4,Se[x]=((K&65280)>>8|(K&255)<<8)>>1}for(var ne=function(t,e,r){for(var n=t.length,o=0,a=new P(e);o<n;++o)t[o]&&++a[t[o]-1];var s=new P(e);for(o=1;o<e;++o)s[o]=s[o-1]+a[o-1]<<1;var i;if(r){i=new P(1<<e);var c=15-e;for(o=0;o<n;++o)if(t[o])for(var l=o<<4|t[o],u=e-t[o],m=s[t[o]-1]++<<u,p=m|(1<<u)-1;m<=p;++m)i[Se[m]>>c]=l}else for(i=new P(n),o=0;o<n;++o)t[o]&&(i[o]=Se[s[t[o]-1]++]>>15-t[o]);return i},Q=new C(288),x=0;x<144;++x)Q[x]=8;for(var x=144;x<256;++x)Q[x]=9;for(var x=256;x<280;++x)Q[x]=7;for(var x=280;x<288;++x)Q[x]=8;for(var fe=new C(32),x=0;x<32;++x)fe[x]=5;var Qe=ne(Q,9,0),Ye=ne(fe,5,0),$e=function(t){return(t+7)/8|0},Ce=function(t,e,r){return(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length),new C(t.subarray(e,r))},Mt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],H=function(t,e,r){var n=new Error(e||Mt[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,H),!r)throw n;return n},N=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},ae=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},Le=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var o=r.length,a=r.slice();if(!o)return{t:Ie,l:0};if(o==1){var s=new C(r[0].s+1);return s[r[0].s]=1,{t:s,l:1}}r.sort(function(T,A){return T.f-A.f}),r.push({s:-1,f:25001});var i=r[0],c=r[1],l=0,u=1,m=2;for(r[0]={s:-1,f:i.f+c.f,l:i,r:c};u!=o-1;)i=r[r[l].f<r[m].f?l++:m++],c=r[l!=u&&r[l].f<r[m].f?l++:m++],r[u++]={s:-1,f:i.f+c.f,l:i,r:c};for(var p=a[0].s,n=1;n<o;++n)a[n].s>p&&(p=a[n].s);var S=new P(p+1),d=Me(r[u-1],S,0);if(d>e){var n=0,f=0,g=d-e,w=1<<g;for(a.sort(function(A,q){return S[q.s]-S[A.s]||A.f-q.f});n<o;++n){var E=a[n].s;if(S[E]>e)f+=w-(1<<d-S[E]),S[E]=e;else break}for(f>>=g;f>0;){var h=a[n].s;S[h]<e?f-=1<<e-S[h]++-1:++n}for(;n>=0&&f;--n){var b=a[n].s;S[b]==e&&(--S[b],++f)}d=e}return{t:new C(S),l:d}},Me=function(t,e,r){return t.s==-1?Math.max(Me(t.l,e,r+1),Me(t.r,e,r+1)):e[t.s]=r},ke=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new P(++e),n=0,o=t[0],a=1,s=function(c){r[n++]=c},i=1;i<=e;++i)if(t[i]==o&&i!=e)++a;else{if(!o&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(o),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(o);a=1,o=t[i]}return{c:r.subarray(0,n),n:e}},oe=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},ze=function(t,e,r){var n=r.length,o=$e(e+2);t[o]=n&255,t[o+1]=n>>8,t[o+2]=t[o]^255,t[o+3]=t[o+1]^255;for(var a=0;a<n;++a)t[o+a+4]=r[a];return(o+4+n)*8},Fe=function(t,e,r,n,o,a,s,i,c,l,u){N(e,u++,r),++o[256];for(var m=Le(o,15),p=m.t,S=m.l,d=Le(a,15),f=d.t,g=d.l,w=ke(p),E=w.c,h=w.n,b=ke(f),T=b.c,A=b.n,q=new P(19),y=0;y<E.length;++y)++q[E[y]&31];for(var y=0;y<T.length;++y)++q[T[y]&31];for(var v=Le(q,7),z=v.t,B=v.l,I=19;I>4&&!z[Ae[I-1]];--I);var le=l+5<<3,O=oe(o,Q)+oe(a,fe)+s,j=oe(o,p)+oe(a,f)+s+14+3*I+oe(q,z)+2*q[16]+3*q[17]+7*q[18];if(c>=0&&le<=O&&le<=j)return ze(e,u,t.subarray(c,c+l));var R,k,U,G;if(N(e,u,1+(j<O)),u+=2,j<O){R=ne(p,S,0),k=p,U=ne(f,g,0),G=f;var Ne=ne(z,B,0);N(e,u,h-257),N(e,u+5,A-1),N(e,u+10,I-4),u+=14;for(var y=0;y<I;++y)N(e,u+3*y,z[Ae[y]]);u+=3*I;for(var Z=[E,T],pe=0;pe<2;++pe)for(var ce=Z[pe],y=0;y<ce.length;++y){var J=ce[y]&31;N(e,u,Ne[J]),u+=z[J],J>15&&(N(e,u,ce[y]>>5&127),u+=ce[y]>>12)}}else R=Qe,k=Q,U=Ye,G=fe;for(var y=0;y<i;++y){var F=n[y];if(F>255){var J=F>>18&31;ae(e,u,R[J+257]),u+=k[J+257],J>7&&(N(e,u,F>>23&31),u+=we[J]);var ue=F&31;ae(e,u,U[ue]),u+=G[ue],ue>3&&(ae(e,u,F>>5&8191),u+=be[ue])}else ae(e,u,R[F]),u+=k[F]}return ae(e,u,R[256]),u+k[256]},Ge=new me([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ie=new C(0),Xe=function(t,e,r,n,o,a){var s=a.z||t.length,i=new C(n+s+5*(1+Math.ceil(s/7e3))+o),c=i.subarray(n,i.length-o),l=a.l,u=(a.r||0)&7;if(e){u&&(c[0]=a.r>>3);for(var m=Ge[e-1],p=m>>13,S=m&8191,d=(1<<r)-1,f=a.p||new P(32768),g=a.h||new P(d+1),w=Math.ceil(r/3),E=2*w,h=function(Re){return(t[Re]^t[Re+1]<<w^t[Re+2]<<E)&d},b=new me(25e3),T=new P(288),A=new P(32),q=0,y=0,v=a.i||0,z=0,B=a.w||0,I=0;v+2<s;++v){var le=h(v),O=v&32767,j=g[le];if(f[O]=j,g[le]=O,B<=v){var R=s-v;if((q>7e3||z>24576)&&(R>423||!l)){u=Fe(t,c,0,b,T,A,y,z,I,v-I,u),z=q=y=0,I=v;for(var k=0;k<286;++k)T[k]=0;for(var k=0;k<30;++k)A[k]=0}var U=2,G=0,Ne=S,Z=O-j&32767;if(R>2&&le==h(v-Z))for(var pe=Math.min(p,R)-1,ce=Math.min(32767,v),J=Math.min(258,R);Z<=ce&&--Ne&&O!=j;){if(t[v+U]==t[v+U-Z]){for(var F=0;F<J&&t[v+F]==t[v+F-Z];++F);if(F>U){if(U=F,G=Z,F>pe)break;for(var ue=Math.min(Z,F-2),pt=0,k=0;k<ue;++k){var We=v-Z+k&32767,cr=f[We],gt=We-cr&32767;gt>pt&&(pt=gt,j=We)}}}O=j,j=f[O],Z+=O-j&32767}if(G){b[z++]=268435456|ye[U]<<18|De[G];var mt=ye[U]&31,wt=De[G]&31;y+=we[mt]+be[wt],++T[257+mt],++A[wt],B=v+U,++q}else b[z++]=t[v],++T[t[v]]}}for(v=Math.max(v,B);v<s;++v)b[z++]=t[v],++T[t[v]];u=Fe(t,c,l,b,T,A,y,z,I,v-I,u),l||(a.r=u&7|c[u/8|0]<<3,u-=7,a.h=g,a.p=f,a.i=v,a.w=B)}else{for(var v=a.w||0;v<s+l;v+=65535){var Be=v+65535;Be>=s&&(c[u/8|0]=l,Be=s),u=ze(c,u+1,t.subarray(v,Be))}a.i=s}return Ce(i,0,n+$e(u)+o)},xt=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t}(),Tt=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=xt[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},Pe=function(t,e,r,n,o){if(!o&&(o={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),s=new C(a.length+t.length);s.set(a),s.set(t,a.length),t=s,o.w=a.length}return Xe(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,o)},_e=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},et=function(t,e,r){for(var n=t(),o=t.toString(),a=o.slice(o.indexOf("[")+1,o.lastIndexOf("]")).replace(/\s+/g,"").split(","),s=0;s<n.length;++s){var i=n[s],c=a[s];if(typeof i=="function"){e+=";"+c+"=";var l=i.toString();if(i.prototype)if(l.indexOf("[native code]")!=-1){var u=l.indexOf(" ",8)+1;e+=l.slice(u,l.indexOf("(",u))}else{e+=l;for(var m in i.prototype)e+=";"+c+".prototype."+m+"="+i.prototype[m].toString()}else e+=l}else r[c]=i}return e},xe=[],Et=function(t){var e=[];for(var r in t)t[r].buffer&&e.push((t[r]=new t[r].constructor(t[r])).buffer);return e},qt=function(t,e,r,n){if(!xe[r]){for(var o="",a={},s=t.length-1,i=0;i<s;++i)o=et(t[i],o,a);xe[r]={c:et(t[s],o,a),e:a}}var c=_e({},xe[r].e);return yt(xe[r].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",r,c,Et(c),n)},At=function(){return[C,P,me,we,be,Ae,ye,De,Qe,Q,Ye,fe,Se,Ge,Ie,ne,N,ae,Le,Me,ke,oe,ze,Fe,$e,Ce,Xe,Pe,zt,Dt]},Dt=function(t){return postMessage(t,[t.buffer])},tt=function(t){return t.ondata=function(e,r){return postMessage([e,r],[e.buffer])},function(e){return t.push(e.data[0],e.data[1])}},$t=function(t,e,r,n,o,a){var s,i=qt(t,n,o,function(c,l){c?(i.terminate(),e.ondata.call(e,c)):Array.isArray(l)?(l[1]&&i.terminate(),e.ondata.call(e,c,l[0],l[1])):a(l)});i.postMessage(r),e.push=function(c,l){e.ondata||H(5),s&&e.ondata(H(4,0,1),null,!!l),i.postMessage([c,s=l],[c.buffer])},e.terminate=function(){i.terminate()}},$=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function Ct(t,e){return typeof t=="function"&&(e=t,t={}),this.ondata=e,t}var rt=function(){function t(e,r){if(typeof e=="function"&&(r=e,e={}),this.ondata=r,this.o=e||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new C(98304),this.o.dictionary){var n=this.o.dictionary.subarray(-32768);this.b.set(n,32768-n.length),this.s.i=32768-n.length}}return t.prototype.p=function(e,r){this.ondata(Pe(e,this.o,0,0,this.s),r)},t.prototype.push=function(e,r){this.ondata||H(5),this.s.l&&H(4);var n=e.length+this.s.z;if(n>this.b.length){if(n>2*this.b.length-32768){var o=new C(n&-32768);o.set(this.b.subarray(0,this.s.z)),this.b=o}var a=this.b.length-this.s.z;a&&(this.b.set(e.subarray(0,a),this.s.z),this.s.z=this.b.length,this.p(this.b,!1)),this.b.set(this.b.subarray(-32768)),this.b.set(e.subarray(a),32768),this.s.z=e.length-a+32768,this.s.i=32766,this.s.w=32768}else this.b.set(e,this.s.z),this.s.z+=e.length;this.s.l=r&1,(this.s.z>this.s.w+8191||r)&&(this.p(this.b,r||!1),this.s.w=this.s.i,this.s.i-=2)},t}(),kt=function(){function t(e,r){$t([At,function(){return[tt,rt]}],this,Ct.call(this,e,r),function(n){var o=new rt(n.data);onmessage=tt(o)},6)}return t}();function zt(t,e){return Pe(t,e||{},0,0)}var nt=typeof TextEncoder<"u"&&new TextEncoder,Ft=typeof TextDecoder<"u"&&new TextDecoder,It=0;try{Ft.decode(Ie,{stream:!0}),It=1}catch{}function He(t,e){if(e){for(var r=new C(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}if(nt)return nt.encode(t);for(var o=t.length,a=new C(t.length+(t.length>>1)),s=0,i=function(u){a[s++]=u},n=0;n<o;++n){if(s+5>a.length){var c=new C(s+8+(o-n<<1));c.set(a),a=c}var l=t.charCodeAt(n);l<128||e?i(l):l<2048?(i(192|l>>6),i(128|l&63)):l>55295&&l<57344?(l=65536+(l&1047552)|t.charCodeAt(++n)&1023,i(240|l>>18),i(128|l>>12&63),i(128|l>>6&63),i(128|l&63)):(i(224|l>>12),i(128|l>>6&63),i(128|l&63))}return Ce(a,0,s)}var Pt=function(t){return t==1?3:t<6?2:t==9?1:0},Te=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;n>65535&&H(9),e+=n+4}return e},at=function(t,e,r,n,o,a,s,i){var c=n.length,l=r.extra,u=i&&i.length,m=Te(l);$(t,e,s!=null?33639248:67324752),e+=4,s!=null&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(a<0&&8),t[e++]=o&&8,t[e++]=r.compression&255,t[e++]=r.compression>>8;var p=new Date(r.mtime==null?Date.now():r.mtime),S=p.getFullYear()-1980;if((S<0||S>119)&&H(10),$(t,e,S<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>1),e+=4,a!=-1&&($(t,e,r.crc),$(t,e+4,a<0?-a-2:a),$(t,e+8,r.size)),$(t,e+12,c),$(t,e+14,m),e+=16,s!=null&&($(t,e,u),$(t,e+6,r.attrs),$(t,e+10,s),e+=14),t.set(n,e),e+=c,m)for(var d in l){var f=l[d],g=f.length;$(t,e,+d),$(t,e+2,g),t.set(f,e+4),e+=4+g}return u&&(t.set(i,e),e+=u),e},Ht=function(t,e,r,n,o){$(t,e,101010256),$(t,e+8,r),$(t,e+10,r),$(t,e+12,n),$(t,e+16,o)},Oe=function(){function t(e){this.filename=e,this.c=Tt(),this.size=0,this.compression=0}return t.prototype.process=function(e,r){this.ondata(null,e,r)},t.prototype.push=function(e,r){this.ondata||H(5),this.c.p(e),this.size+=e.length,r&&(this.crc=this.c.d()),this.process(e,r||!1)},t}(),Ot=function(){function t(e,r){var n=this;r||(r={}),Oe.call(this,e),this.d=new kt(r,function(o,a,s){n.ondata(o,a,s)}),this.compression=8,this.flag=Pt(r.level),this.terminate=this.d.terminate}return t.prototype.process=function(e,r){this.d.push(e,r)},t.prototype.push=function(e,r){Oe.prototype.push.call(this,e,r)},t}(),jt=function(){function t(e){this.ondata=e,this.u=[],this.d=1}return t.prototype.add=function(e){var r=this;if(this.ondata||H(5),this.d&2)this.ondata(H(4+(this.d&1)*8,0,1),null,!1);else{var n=He(e.filename),o=n.length,a=e.comment,s=a&&He(a),i=o!=e.filename.length||s&&a.length!=s.length,c=o+Te(e.extra)+30;o>65535&&this.ondata(H(11,0,1),null,!1);var l=new C(c);at(l,0,e,n,i,-1);var u=[l],m=function(){for(var g=0,w=u;g<w.length;g++){var E=w[g];r.ondata(null,E,!1)}u=[]},p=this.d;this.d=0;var S=this.u.length,d=_e(e,{f:n,u:i,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(m(),p){var g=r.u[S+1];g?g.r():r.d=1}p=1}}),f=0;e.ondata=function(g,w,E){if(g)r.ondata(g,w,E),r.terminate();else if(f+=w.length,u.push(w),E){var h=new C(16);$(h,0,134695760),$(h,4,e.crc),$(h,8,f),$(h,12,e.size),u.push(h),d.c=f,d.b=c+f+16,d.crc=e.crc,d.size=e.size,p&&d.r(),p=1}else p&&m()},this.u.push(d)}},t.prototype.end=function(){var e=this;if(this.d&2){this.ondata(H(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){e.d&1&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var e=0,r=0,n=0,o=0,a=this.u;o<a.length;o++){var s=a[o];n+=46+s.f.length+Te(s.extra)+(s.o?s.o.length:0)}for(var i=new C(n+22),c=0,l=this.u;c<l.length;c++){var s=l[c];at(i,e,s,s.f,s.u,-s.c-2,r,s.o),e+=46+s.f.length+Te(s.extra)+(s.o?s.o.length:0),r+=s.b}Ht(i,e,this.u.length,n,r),this.ondata(null,i,!0),this.d=2},t.prototype.terminate=function(){for(var e=0,r=this.u;e<r.length;e++){var n=r[e];n.t()}this.d=2},t}();class Ut{constructor(e){Ze(this,"value");Ze(this,"next");this.value=e}}class Nt{constructor(){qe(this,W,void 0);qe(this,ee,void 0);qe(this,te,void 0);this.clear()}enqueue(e){const r=new Ut(e);X(this,W)?(X(this,ee).next=r,V(this,ee,r)):(V(this,W,r),V(this,ee,r)),Je(this,te)._++}dequeue(){const e=X(this,W);if(e)return V(this,W,X(this,W).next),Je(this,te)._--,e.value}clear(){V(this,W,void 0),V(this,ee,void 0),V(this,te,0)}get size(){return X(this,te)}*[Symbol.iterator](){let e=X(this,W);for(;e;)yield e.value,e=e.next}}W=new WeakMap,ee=new WeakMap,te=new WeakMap;const Wt={bind(t,e,r){return t.bind(r)}};function Bt(t){if(!((Number.isInteger(t)||t===Number.POSITIVE_INFINITY)&&t>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const e=new Nt;let r=0;const n=()=>{r--,e.size>0&&e.dequeue()()},o=async(i,c,l)=>{r++;const u=(async()=>i(...l))();c(u);try{await u}catch{}n()},a=(i,c,l)=>{e.enqueue(Wt.bind(o.bind(void 0,i,c,l))),(async()=>(await Promise.resolve(),r<t&&e.size>0&&e.dequeue()()))()},s=(i,...c)=>new Promise(l=>{a(i,l,c)});return Object.defineProperties(s,{activeCount:{get:()=>r},pendingCount:{get:()=>e.size},clearQueue:{value(){e.clear()}}}),s}var ot={exports:{}};/*! streamsaver. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */(function(t){((e,r)=>{t.exports=r()})("streamSaver",()=>{const e=typeof window=="object"?window:this;e.HTMLElement||console.warn("streamsaver is meant to run on browsers main thread");let r=null,n=!1;const o=d=>{try{d()}catch{}},a=e.WebStreamsPolyfill||{},s=e.isSecureContext;let i=/constructor/i.test(e.HTMLElement)||!!e.safari||!!e.WebKitPoint;const c=s||"MozAppearance"in document.documentElement.style?"iframe":"navigate",l={createWriteStream:S,WritableStream:e.WritableStream||a.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function u(d){if(!d)throw new Error("meh");const f=document.createElement("iframe");return f.hidden=!0,f.src=d,f.loaded=!1,f.name="iframe",f.isIframe=!0,f.postMessage=(...g)=>f.contentWindow.postMessage(...g),f.addEventListener("load",()=>{f.loaded=!0},{once:!0}),document.body.appendChild(f),f}function m(d){const f="width=200,height=100",g=document.createDocumentFragment(),w={frame:e.open(d,"popup",f),loaded:!1,isIframe:!1,isPopup:!0,remove(){w.frame.close()},addEventListener(...h){g.addEventListener(...h)},dispatchEvent(...h){g.dispatchEvent(...h)},removeEventListener(...h){g.removeEventListener(...h)},postMessage(...h){w.frame.postMessage(...h)}},E=h=>{h.source===w.frame&&(w.loaded=!0,e.removeEventListener("message",E),w.dispatchEvent(new Event("load")))};return e.addEventListener("message",E),w}try{new Response(new ReadableStream),s&&!("serviceWorker"in navigator)&&(i=!0)}catch{i=!0}o(()=>{const{readable:d}=new TransformStream,f=new MessageChannel;f.port1.postMessage(d,[d]),f.port1.close(),f.port2.close(),n=!0,Object.defineProperty(l,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})});function p(){r||(r=s?u(l.mitm):m(l.mitm))}function S(d,f,g){let w={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},E=0,h=null,b=null,T=null;if(Number.isFinite(f)?([g,f]=[f,g],console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),w.size=g,w.writableStrategy=f):f&&f.highWaterMark?(console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),w.size=g,w.writableStrategy=f):w=f||{},!i){p(),b=new MessageChannel,d=encodeURIComponent(d.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const q={transferringReadable:n,pathname:w.pathname||Math.random().toString().slice(-6)+"/"+d,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+d}};w.size&&(q.headers["Content-Length"]=w.size);const y=[q,"*",[b.port2]];if(n){const v=c==="iframe"?void 0:{transform(B,I){if(!(B instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");E+=B.length,I.enqueue(B),h&&(location.href=h,h=null)},flush(){h&&(location.href=h)}};T=new l.TransformStream(v,w.writableStrategy,w.readableStrategy);const z=T.readable;b.port1.postMessage({readableStream:z},[z])}b.port1.onmessage=v=>{v.data.download?c==="navigate"?(r.remove(),r=null,E?location.href=v.data.download:h=v.data.download):(r.isPopup&&(r.remove(),r=null,c==="iframe"&&u(l.mitm)),u(v.data.download)):v.data.abort&&(A=[],b.port1.postMessage("abort"),b.port1.onmessage=null,b.port1.close(),b.port2.close(),b=null)},r.loaded?r.postMessage(...y):r.addEventListener("load",()=>{r.postMessage(...y)},{once:!0})}let A=[];return!i&&T&&T.writable||new l.WritableStream({write(q){if(!(q instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");if(i){A.push(q);return}b.port1.postMessage(q),E+=q.length,h&&(location.href=h,h=null)},close(){if(i){const q=new Blob(A,{type:"application/octet-stream; charset=utf-8"}),y=document.createElement("a");y.href=URL.createObjectURL(q),y.download=d,y.click()}else b.port1.postMessage("end")},abort(){A=[],b.port1.postMessage("abort"),b.port1.onmessage=null,b.port1.close(),b.port2.close(),b=null}},w.writableStrategy)}return l})})(ot);var Rt=ot.exports;const Zt=[2,3,5,7,11,13,17,19],Jt=Bt(4),Vt=({title:t,artists:e,magazines:r})=>{const n=[];return e&&(e.length===1?n.push(`[${e[0]}]`):e.length===2?n.push(`[${e[0]} & ${e[1]}]`):e.length>=3&&n.push("[Various]")),n.push(t),(r==null?void 0:r.length)===1&&n.push(`(${r[0]})`),n.join(" ").replace("＊","*").replace("？","?").replace("⁄","/").replace("Ꞓ",":")},Kt=t=>{const e=atob(t),r=e.length,n=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=e.charCodeAt(o);return n},Qt=t=>{const e="hentainexus.com",r=Kt(t);for(let f=0;f<e.length;f++)r[f]^=e.charCodeAt(f);const n=r.slice(0,64).map(f=>f&255),o=r.slice(64).map(f=>f&255),a=[...Array(256).keys()];let s=0;for(let f=0;f<64;f++){s^=n[f];for(let g=0;g<8;g++)s=s&1?s>>>1^12:s>>>1}s&=7;let i,c=0;for(let f=0;f<256;f++)c=(c+a[f]+n[f%64])%256,i=a[f],a[f]=a[c],a[c]=i;const l=Zt[s];let u=0,m=0,p=0,S=0,d="";for(let f=0;f<o.length;f++)u=(u+l)%256,m=(p+a[(m+a[u])%256])%256,p=(p+u+a[u])%256,i=a[u],a[u]=a[m],a[m]=i,S=a[(m+a[(u+a[(S+p)%256])%256])%256],d+=String.fromCharCode(o[f]^S);return d},Yt=async(t,e)=>{const n=await(await fetch(t.image)).blob(),o=n.type.split("/").at(-1),a=new Oe(`${t.url_label}.${o}`);e.add(a),await n.arrayBuffer().then(s=>{a.push(new Uint8Array(s),!0)})},st=async(t,e,r)=>new Promise((n,o)=>{var m,p,S,d;const s=Rt.createWriteStream(`${Vt(t)}.cbz`).getWriter(),i=new jt;i.ondata=async(f,g,w)=>{f?(s.abort(),o(f)):(s.write(g),w&&s.close())};const c=new Ot("info.json");i.add(c),c.push(He(JSON.stringify({Title:t.title,Description:t.description,Artist:(m=t.artists)==null?void 0:m.join(", "),Groups:t.circles,Magazine:(p=t.magazines)==null?void 0:p.join(", "),Parody:(S=t.parodies)==null?void 0:S.join(", "),Publisher:(d=t.publishers)==null?void 0:d.join(", "),Published:t.published&&new Date(t.published).getTime()/1e3,Pages:t.pages,Favorites:t.favorites,Tags:t.tags,Source:`https://hentainexus.com/view/${t.id}`},null,2)),!0);let l=0;Promise.all(e.map(f=>Jt(()=>Yt(f,i).then(()=>{l++,r(l)})))).then(()=>{i.end(),n()});const u=()=>s.abort();window.addEventListener("beforeunload",u),s.closed.then(()=>window.removeEventListener("beforeunload",u))}),it=async t=>{const e=await fetch(`/read/${t}`);if(!e.ok)throw new Error(`[${e.status}] ${e.statusText} - Failed to get images for ${t}`);const r=await e.text(),n=new DOMParser().parseFromString(r,"text/html"),a=Array.from(n.querySelectorAll("script")).find(c=>c.innerHTML.includes("initReader")).innerHTML.match(/initReader\("([^"]*)"/)[1],s=JSON.parse(Qt(a)).filter(c=>c.type==="image");return localStorage.getItem("strip_filter")==="true"?s.map(c=>({...c,image:c.image.replace("?filter=null","")})):s},de='<svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" viewBox="0 0 24 24"><path fill="currentColor" d="M5 21v-1h14v1zm6.98-3.77L6.366 9.789h3.27V3h4.711v6.788h3.27z"/></svg>',lt='<svg xmlns="http://www.w3.org/2000/svg" class="animate-spin" width="1.3rem" height="1.3rem" viewBox="0 0 24 24"><g fill="currentColor"><path fill-rule="evenodd" d="M12 19a7 7 0 1 0 0-14a7 7 0 0 0 0 14m0 3c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10" clip-rule="evenodd" opacity=".2"/><path d="M2 12C2 6.477 6.477 2 12 2v3a7 7 0 0 0-7 7z"/></g></svg>',ct='<svg xmlns="http://www.w3.org/2000/svg" width="1.3rem" height="1.3rem" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M3.47 3.47a.75.75 0 0 1 1.06 0L8 6.94l3.47-3.47a.75.75 0 1 1 1.06 1.06L9.06 8l3.47 3.47a.75.75 0 1 1-1.06 1.06L8 9.06l-3.47 3.47a.75.75 0 0 1-1.06-1.06L6.94 8L3.47 4.53a.75.75 0 0 1 0-1.06" clip-rule="evenodd"/></svg>';function je(){}function Gt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}const se=[];function ut(t,e=je){let r;const n=new Set;function o(i){if(Gt(t,i)&&(t=i,r)){const c=!se.length;for(const l of n)l[1](),se.push(l,t);if(c){for(let l=0;l<se.length;l+=2)se[l][0](se[l+1]);se.length=0}}}function a(i){o(i(t))}function s(i,c=je){const l=[i,c];return n.add(l),n.size===1&&(r=e(o,a)||je),i(t),()=>{n.delete(l),n.size===0&&r&&(r(),r=null)}}return{set:o,update:a,subscribe:s}}const ie=(()=>{const t=JSON.parse(localStorage.getItem("downloads")||"[]"),{set:e,subscribe:r}=ut(t);return{get:()=>t,add:s=>{t.includes(s)||t.push(s),e(t),localStorage.setItem("downloads",JSON.stringify(t))},includes:s=>t.includes(s),subscribe:r}})(),he=t=>Number(t.querySelector("a").getAttribute("href").split("/").at(-1)),Xt=t=>{const e=({id:s,title:i})=>{const c=t.find(l=>s===he(l));if(c){const l=c.querySelector('button[role="download"]');l.setAttribute("state","processing"),l.classList.add("disabled"),l.classList.remove("downloaded","failed"),l.innerHTML=lt,console.log(`Started download for (${s}) '${i}'`)}},r=({id:s},i,c)=>{const l=t.find(u=>s===he(u));if(l){const u=l.querySelector(`span[download="${s}"]`);u.innerHTML=`${i}/${c}`}},n=({id:s,title:i})=>{const c=t.find(l=>s===he(l));if(c){const l=c.querySelector('button[role="download"]');l.innerHTML=de,console.log(`Finished download for (${s}) '${i}'`),a(s)}},o=({id:s,title:i},c)=>{const l=t.find(u=>s===he(u));if(l){const u=l.querySelector('button[role="download"]');u.classList.add("failed"),u.innerHTML=ct,console.error(`Failed download for (${s}) '${i}'`,c),a(s)}},a=s=>{const i=t.find(u=>s===he(u)),c=i.querySelector('button[role="download"]');c.setAttribute("state","idle"),c.classList.remove("disabled");const l=i.querySelector(`span[download="${s}"]`);l.innerHTML=""};return{start:e,progress:r,finish:n,fail:o}},ft=()=>{const{update:t,subscribe:e}=ut({kind:"idle"});return{idle:()=>{t(i=>({...i,kind:"idle"}))},starting:()=>{t(i=>({...i,kind:"starting"}))},processing:(i,c)=>{t(l=>({...l,kind:"processing",progress:i,total:c}))},success:(i,c)=>{t(l=>({...l,kind:"success",progress:i,total:c}))},fail:()=>{t(i=>({...i,kind:"failed"}))},subscribe:e}},dt=t=>new Promise(e=>setTimeout(e,t)),ve=ft(),Ee=Array.from(document.querySelectorAll(".column")),Y=Xt(Ee),_t=()=>{const t=document.createElement("button");return t.innerHTML="Download all",t.classList.add("button","pagination-next","download-header"),ve.subscribe(e=>{switch(e.kind){case"idle":t.innerHTML="Download all",t.classList.remove("disabled");break;case"processing":t.innerHTML=`(${e.progress}/${e.total}) Downloading`,t.classList.add("disabled");break;case"success":t.innerHTML=`(${e.progress}/${e.total}) Download finished`,t.classList.add("disabled");break}}),t},ht=async t=>{const e=await re(t.id),r=await it(t.id);Y.progress(t,0,r.length),await st(e,r,n=>Y.progress(t,n,r.length))},er=async()=>{let t=Ee.map(r=>({id:Number(r.querySelector("a").getAttribute("href").split("/").at(-1)),title:r.querySelector(".card-header").getAttribute("title")}));localStorage.getItem("skip_download")==="true"&&(t=t.filter(r=>!ie.includes(r.id)));let e=0;for(const r of t)ve.processing(e,t.length),Y.start(r),await ht(r).then(()=>{e++,ve.processing(e,t.length),Y.finish(r),ie.add(r.id)}).catch(n=>{Y.fail(r,n)});ve.success(e,t.length),await dt(2500),ve.idle()},tr=()=>{const t=document.querySelector(".search-title"),e=_t();if(e.addEventListener("click",er),t){const r=t.parentElement;r.classList.add("flex","space-between"),r.append(e)}else{e.classList.add("ms-auto");const r=document.createElement("div");r.classList.add("container","flex","mb-6"),r.append(e),document.querySelector("section.section:not(.is-hidden)").prepend(r)}},rr=()=>{for(const t of Ee){const e=Number(t.querySelector("a").getAttribute("href").split("/").at(-1)),r=t.querySelector(".card-header").getAttribute("title"),n=document.createElement("button");n.id=`download-${e}`,n.role="download",n.title=`Download '${r}'`,n.innerHTML=de,n.classList.add("button","grey","download-icon"),ie.includes(e)&&n.classList.add("downloaded"),n.addEventListener("click",s=>{s.preventDefault();const i={id:e,title:r};Y.start(i),ht(i).then(()=>{Y.finish(i),ie.add(e)}).catch(c=>{Y.fail(i,c)})});const o=document.createElement("span");o.classList.add("progress-text"),o.setAttribute("download",e.toString());const a=t.querySelector(".card-header");a.classList.add("flex","items-center"),a.appendChild(o),a.appendChild(n)}},nr=Object.freeze(Object.defineProperty({__proto__:null,init:()=>{tr(),rr(),ie.subscribe(t=>{Ee.forEach(e=>{const r=e.querySelector('button[role="download"');if(r.getAttribute("state")!=="idle")return;const o=Number(r.getAttribute("id").replace("download-",""));t.includes(o)?r.classList.add("downloaded"):r.classList.remove("downloaded")})})}},Symbol.toStringTag,{value:"Module"})),_=ft(),Ue=D(document),ar=async t=>{t.preventDefault();try{_.starting();const e=await it(Ue.id);_.processing(0,e.length);let r=0;await st(Ue,e,n=>{r=n,_.processing(n,e.length)}),_.success(r,e.length)}catch(e){_.fail(),console.error("Failed to download gallery",e)}};function or(){const t=document.querySelector(".level-left > .level-item"),e=t.cloneNode(!0);e.querySelector("a").removeAttribute("href"),e.querySelector(".icon").innerHTML=de,e.querySelector(".button-label").innerHTML="Download",e.addEventListener("click",ar),t.after(e),_.subscribe(async r=>{switch(r.kind){case"idle":e.classList.remove("disabled"),e.querySelector(".icon").innerHTML=de,e.querySelector(".button-label").innerHTML="Download";break;case"starting":e.classList.add("disabled"),e.querySelector(".icon").innerHTML=lt,e.querySelector(".button-label").innerHTML="Downloading";break;case"processing":e.classList.add("disabled"),e.querySelector(".button-label").innerHTML=`Downloading (${r.progress}/${r.total})`;break;case"failed":e.classList.remove("disabled"),e.querySelector(".icon").innerHTML=ct,e.querySelector(".button-label").innerHTML="Download Failed";break;case"success":e.querySelector(".icon").innerHTML=de,e.classList.add("disabled"),e.querySelector(".button-label").innerHTML=`Downloaded (${r.progress}/${r.total})`,ie.add(Ue.id),await dt(1500),_.idle();break}})}const sr=Object.freeze(Object.defineProperty({__proto__:null,init:()=>{or()}},Symbol.toStringTag,{value:"Module"})),vt=({name:t,description:e,value:r})=>{const n=document.createElement("div");n.classList.add("field");const o=document.createElement("input");o.id=t,o.name=t,o.style.marginRight="0.5rem",o.type="checkbox",o.checked=r;const a=document.createElement("label");return a.htmlFor=t,a.innerHTML=e,n.append(o,a),n},ir=()=>{const t=document.querySelector(".container"),e=document.createElement("hr"),r=document.createElement("h4");r.classList.add("title","is-4"),r.innerHTML="Script settings";const n=document.createElement("form");n.onsubmit=()=>{const m=new FormData(n),p=Object.fromEntries(m);localStorage.setItem("skip_download",p.skip_download?"true":"false"),localStorage.setItem("strip_filter",p.strip_filter?"true":"false"),location.reload()};const o=localStorage.getItem("skip_download"),a=localStorage.getItem("strip_filter"),s=vt({name:"skip_download",description:"Skip downloaded galleries from batch downloads.",value:o==="true"}),i=vt({name:"strip_filter",description:"Avoid striping '?filter=null' from the image URL. Enable this if downloads fail or are incomplete.",value:a==="true"});n.append(s,i);const c=document.createElement("div");c.classList.add("filter"),c.innerHTML='<div class="control"><button class="button is-primary">Submit</button></div>',n.append(c);const l=document.createElement("div");l.classList.add("columns");const u=document.createElement("div");u.classList.add("column"),u.append(n),l.append(u),t.append(e),t.append(r),t.append(l)},lr=Object.freeze(Object.defineProperty({__proto__:null,init:()=>{ir()}},Symbol.toStringTag,{value:"Module"}))});
