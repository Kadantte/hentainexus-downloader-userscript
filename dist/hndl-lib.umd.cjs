(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".disabled{pointer-events:none}.animate-spin{animation:spin 1s linear infinite}.download-header{margin:0;background:0}.grey path{fill:#bdcbdb}.has-background-primary .grey path{fill:#fff}.download-icon{height:100%;padding:.75rem;border:none;background:none!important;outline:none}.progress-text{font-size:.75rem;font-weight:600}.flex{display:flex}.mb-6{margin-bottom:1.5rem}.ms-auto{margin-inline-start:auto}.space-between{justify-content:space-between}.items-center{align-items:center}.downloaded path{fill:#5cb85c}.has-background-primary .downloaded path{fill:#7be57b}.failed path{fill:#ec5b56!important}.has-background-primary .failed path{fill:#6b1717!important}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}")),document.head.appendChild(e)}}catch(n){console.error("vite-plugin-css-injected-by-js",n)}})();
(function(S){typeof define=="function"&&define.amd?define(S):S()})(function(){"use strict";var ur=Object.defineProperty;var fr=(S,L,E)=>L in S?ur(S,L,{enumerable:!0,configurable:!0,writable:!0,value:E}):S[L]=E;var Ze=(S,L,E)=>(fr(S,typeof L!="symbol"?L+"":L,E),E),bt=(S,L,E)=>{if(!L.has(S))throw TypeError("Cannot "+E)};var X=(S,L,E)=>(bt(S,L,"read from private field"),E?E.call(S):L.get(S)),qe=(S,L,E)=>{if(L.has(S))throw TypeError("Cannot add the same private member more than once");L instanceof WeakSet?L.add(S):L.set(S,E)},V=(S,L,E,re)=>(bt(S,L,"write to private field"),re?re.call(S,E):L.set(S,E),E);var Je=(S,L,E,re)=>({set _(ge){V(S,L,ge,E)},get _(){return X(S,L,re)}});var N,ee,te;location.pathname=="/"||location.pathname.startsWith("/page")||location.pathname.startsWith("/favorites")?Promise.resolve().then(()=>nr).then(t=>t.init()):location.pathname.startsWith("/view/")?Promise.resolve().then(()=>sr).then(t=>t.init()):location.pathname.startsWith("/settings")&&Promise.resolve().then(()=>lr).then(t=>t.init());const S=(t,e)=>Array.from(e.querySelectorAll(".view-page-details tr")).find(n=>{var a,o;return(o=(a=n.querySelector("td"))==null?void 0:a.textContent)==null?void 0:o.includes(t)}),L=(t,e)=>{const r=S(t,e);if(r)return Array.from(r.querySelectorAll("a")).map(n=>n.childNodes[0].textContent.trim())},E=t=>{var v,y,f;const e=Number(t.querySelector('a[href^="/read/"]').getAttribute("href").split("/").at(-1)),r=t.querySelector("h1.title").textContent,n=(f=(y=(v=S("Description",t))==null?void 0:v.querySelector("td:last-of-type"))==null?void 0:y.textContent)==null?void 0:f.trim(),a=L("Artist",t),o=L("Circle",t),s=L("Magazine",t),l=L("Parody",t),c=L("Publisher",t),i=parseInt(S("Pages",t).querySelector("td:last-of-type").textContent.trim()),u=parseInt(S("Favorites",t).querySelector("td:last-of-type").textContent.trim()),p=Array.from(S("Tags",t).querySelectorAll(".tag")).map(d=>d.textContent.trim().split("(")[0].trim());return{id:e,title:r,description:n,artists:a,circles:o,magazines:s,parodies:l,publishers:c,pages:i,favorites:u,tags:p}},re=async t=>{const e=await fetch(`/view/${t}`);if(!e.ok)throw new Error(`[${e.status}] ${e.statusText} - Failed to get metadata for ${t}`);const r=await e.text(),n=new DOMParser().parseFromString(r,"text/html");return E(n)};var ge={},yt=function(t,e,r,n,a){var o=new Worker(ge[e]||(ge[e]=URL.createObjectURL(new Blob([t+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return o.onmessage=function(s){var l=s.data,c=l.$e$;if(c){var i=new Error(c[0]);i.code=c[1],i.stack=c[2],a(i,null)}else a(null,l)},o.postMessage(r,n),o},$=Uint8Array,H=Uint16Array,me=Int32Array,we=new $([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),be=new $([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ae=new $([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ve=function(t,e){for(var r=new H(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var a=new me(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)a[o]=o-r[n]<<5|n;return{b:r,r:a}},Ke=Ve(we,2),St=Ke.b,ye=Ke.r;St[28]=258,ye[258]=28;for(var Lt=Ve(be,0),$e=Lt.r,Se=new H(32768),x=0;x<32768;++x){var K=(x&43690)>>1|(x&21845)<<1;K=(K&52428)>>2|(K&13107)<<2,K=(K&61680)>>4|(K&3855)<<4,Se[x]=((K&65280)>>8|(K&255)<<8)>>1}for(var ne=function(t,e,r){for(var n=t.length,a=0,o=new H(e);a<n;++a)t[a]&&++o[t[a]-1];var s=new H(e);for(a=1;a<e;++a)s[a]=s[a-1]+o[a-1]<<1;var l;if(r){l=new H(1<<e);var c=15-e;for(a=0;a<n;++a)if(t[a])for(var i=a<<4|t[a],u=e-t[a],p=s[t[a]-1]++<<u,v=p|(1<<u)-1;p<=v;++p)l[Se[p]>>c]=i}else for(l=new H(n),a=0;a<n;++a)t[a]&&(l[a]=Se[s[t[a]-1]++]>>15-t[a]);return l},Q=new $(288),x=0;x<144;++x)Q[x]=8;for(var x=144;x<256;++x)Q[x]=9;for(var x=256;x<280;++x)Q[x]=7;for(var x=280;x<288;++x)Q[x]=8;for(var fe=new $(32),x=0;x<32;++x)fe[x]=5;var Qe=ne(Q,9,0),Ye=ne(fe,5,0),De=function(t){return(t+7)/8|0},Ce=function(t,e,r){return(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length),new $(t.subarray(e,r))},Mt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],P=function(t,e,r){var n=new Error(e||Mt[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,P),!r)throw n;return n},B=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},ae=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},Le=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var a=r.length,o=r.slice();if(!a)return{t:Ie,l:0};if(a==1){var s=new $(r[0].s+1);return s[r[0].s]=1,{t:s,l:1}}r.sort(function(D,k){return D.f-k.f}),r.push({s:-1,f:25001});var l=r[0],c=r[1],i=0,u=1,p=2;for(r[0]={s:-1,f:l.f+c.f,l,r:c};u!=a-1;)l=r[r[i].f<r[p].f?i++:p++],c=r[i!=u&&r[i].f<r[p].f?i++:p++],r[u++]={s:-1,f:l.f+c.f,l,r:c};for(var v=o[0].s,n=1;n<a;++n)o[n].s>v&&(v=o[n].s);var y=new H(v+1),f=Me(r[u-1],y,0);if(f>e){var n=0,d=0,m=f-e,g=1<<m;for(o.sort(function(k,T){return y[T.s]-y[k.s]||k.f-T.f});n<a;++n){var A=o[n].s;if(y[A]>e)d+=g-(1<<f-y[A]),y[A]=e;else break}for(d>>=m;d>0;){var b=o[n].s;y[b]<e?d-=1<<e-y[b]++-1:++n}for(;n>=0&&d;--n){var M=o[n].s;y[M]==e&&(--y[M],++d)}f=e}return{t:new $(y),l:f}},Me=function(t,e,r){return t.s==-1?Math.max(Me(t.l,e,r+1),Me(t.r,e,r+1)):e[t.s]=r},ke=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new H(++e),n=0,a=t[0],o=1,s=function(c){r[n++]=c},l=1;l<=e;++l)if(t[l]==a&&l!=e)++o;else{if(!a&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(a),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(a);o=1,a=t[l]}return{c:r.subarray(0,n),n:e}},oe=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},ze=function(t,e,r){var n=r.length,a=De(e+2);t[a]=n&255,t[a+1]=n>>8,t[a+2]=t[a]^255,t[a+3]=t[a+1]^255;for(var o=0;o<n;++o)t[a+o+4]=r[o];return(a+4+n)*8},Fe=function(t,e,r,n,a,o,s,l,c,i,u){B(e,u++,r),++a[256];for(var p=Le(a,15),v=p.t,y=p.l,f=Le(o,15),d=f.t,m=f.l,g=ke(v),A=g.c,b=g.n,M=ke(d),D=M.c,k=M.n,T=new H(19),w=0;w<A.length;++w)++T[A[w]&31];for(var w=0;w<D.length;++w)++T[D[w]&31];for(var h=Le(T,7),z=h.t,W=h.l,I=19;I>4&&!z[Ae[I-1]];--I);var le=i+5<<3,O=oe(a,Q)+oe(o,fe)+s,j=oe(a,v)+oe(o,d)+s+14+3*I+oe(T,z)+2*T[16]+3*T[17]+7*T[18];if(c>=0&&le<=O&&le<=j)return ze(e,u,t.subarray(c,c+i));var R,C,U,G;if(B(e,u,1+(j<O)),u+=2,j<O){R=ne(v,y,0),C=v,U=ne(d,m,0),G=d;var Be=ne(z,W,0);B(e,u,b-257),B(e,u+5,k-1),B(e,u+10,I-4),u+=14;for(var w=0;w<I;++w)B(e,u+3*w,z[Ae[w]]);u+=3*I;for(var Z=[A,D],pe=0;pe<2;++pe)for(var ce=Z[pe],w=0;w<ce.length;++w){var J=ce[w]&31;B(e,u,Be[J]),u+=z[J],J>15&&(B(e,u,ce[w]>>5&127),u+=ce[w]>>12)}}else R=Qe,C=Q,U=Ye,G=fe;for(var w=0;w<l;++w){var F=n[w];if(F>255){var J=F>>18&31;ae(e,u,R[J+257]),u+=C[J+257],J>7&&(B(e,u,F>>23&31),u+=we[J]);var ue=F&31;ae(e,u,U[ue]),u+=G[ue],ue>3&&(ae(e,u,F>>5&8191),u+=be[ue])}else ae(e,u,R[F]),u+=C[F]}return ae(e,u,R[256]),u+C[256]},Ge=new me([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ie=new $(0),Xe=function(t,e,r,n,a,o){var s=o.z||t.length,l=new $(n+s+5*(1+Math.ceil(s/7e3))+a),c=l.subarray(n,l.length-a),i=o.l,u=(o.r||0)&7;if(e){u&&(c[0]=o.r>>3);for(var p=Ge[e-1],v=p>>13,y=p&8191,f=(1<<r)-1,d=o.p||new H(32768),m=o.h||new H(f+1),g=Math.ceil(r/3),A=2*g,b=function(Re){return(t[Re]^t[Re+1]<<g^t[Re+2]<<A)&f},M=new me(25e3),D=new H(288),k=new H(32),T=0,w=0,h=o.i||0,z=0,W=o.w||0,I=0;h+2<s;++h){var le=b(h),O=h&32767,j=m[le];if(d[O]=j,m[le]=O,W<=h){var R=s-h;if((T>7e3||z>24576)&&(R>423||!i)){u=Fe(t,c,0,M,D,k,w,z,I,h-I,u),z=T=w=0,I=h;for(var C=0;C<286;++C)D[C]=0;for(var C=0;C<30;++C)k[C]=0}var U=2,G=0,Be=y,Z=O-j&32767;if(R>2&&le==b(h-Z))for(var pe=Math.min(v,R)-1,ce=Math.min(32767,h),J=Math.min(258,R);Z<=ce&&--Be&&O!=j;){if(t[h+U]==t[h+U-Z]){for(var F=0;F<J&&t[h+F]==t[h+F-Z];++F);if(F>U){if(U=F,G=Z,F>pe)break;for(var ue=Math.min(Z,F-2),pt=0,C=0;C<ue;++C){var Ne=h-Z+C&32767,cr=d[Ne],gt=Ne-cr&32767;gt>pt&&(pt=gt,j=Ne)}}}O=j,j=d[O],Z+=O-j&32767}if(G){M[z++]=268435456|ye[U]<<18|$e[G];var mt=ye[U]&31,wt=$e[G]&31;w+=we[mt]+be[wt],++D[257+mt],++k[wt],W=h+U,++T}else M[z++]=t[h],++D[t[h]]}}for(h=Math.max(h,W);h<s;++h)M[z++]=t[h],++D[t[h]];u=Fe(t,c,i,M,D,k,w,z,I,h-I,u),i||(o.r=u&7|c[u/8|0]<<3,u-=7,o.h=m,o.p=d,o.i=h,o.w=W)}else{for(var h=o.w||0;h<s+i;h+=65535){var We=h+65535;We>=s&&(c[u/8|0]=i,We=s),u=ze(c,u+1,t.subarray(h,We))}o.i=s}return Ce(l,0,n+De(u)+a)},xt=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t}(),Tt=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=xt[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},He=function(t,e,r,n,a){if(!a&&(a={l:1},e.dictionary)){var o=e.dictionary.subarray(-32768),s=new $(o.length+t.length);s.set(o),s.set(t,o.length),t=s,a.w=o.length}return Xe(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,a)},_e=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},et=function(t,e,r){for(var n=t(),a=t.toString(),o=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/\s+/g,"").split(","),s=0;s<n.length;++s){var l=n[s],c=o[s];if(typeof l=="function"){e+=";"+c+"=";var i=l.toString();if(l.prototype)if(i.indexOf("[native code]")!=-1){var u=i.indexOf(" ",8)+1;e+=i.slice(u,i.indexOf("(",u))}else{e+=i;for(var p in l.prototype)e+=";"+c+".prototype."+p+"="+l.prototype[p].toString()}else e+=i}else r[c]=l}return e},xe=[],Et=function(t){var e=[];for(var r in t)t[r].buffer&&e.push((t[r]=new t[r].constructor(t[r])).buffer);return e},qt=function(t,e,r,n){if(!xe[r]){for(var a="",o={},s=t.length-1,l=0;l<s;++l)a=et(t[l],a,o);xe[r]={c:et(t[s],a,o),e:o}}var c=_e({},xe[r].e);return yt(xe[r].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",r,c,Et(c),n)},At=function(){return[$,H,me,we,be,Ae,ye,$e,Qe,Q,Ye,fe,Se,Ge,Ie,ne,B,ae,Le,Me,ke,oe,ze,Fe,De,Ce,Xe,He,zt,$t]},$t=function(t){return postMessage(t,[t.buffer])},tt=function(t){return t.ondata=function(e,r){return postMessage([e,r],[e.buffer])},function(e){return t.push(e.data[0],e.data[1])}},Dt=function(t,e,r,n,a,o){var s,l=qt(t,n,a,function(c,i){c?(l.terminate(),e.ondata.call(e,c)):Array.isArray(i)?(i[1]&&l.terminate(),e.ondata.call(e,c,i[0],i[1])):o(i)});l.postMessage(r),e.push=function(c,i){e.ondata||P(5),s&&e.ondata(P(4,0,1),null,!!i),l.postMessage([c,s=i],[c.buffer])},e.terminate=function(){l.terminate()}},q=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function Ct(t,e){return typeof t=="function"&&(e=t,t={}),this.ondata=e,t}var rt=function(){function t(e,r){if(typeof e=="function"&&(r=e,e={}),this.ondata=r,this.o=e||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new $(98304),this.o.dictionary){var n=this.o.dictionary.subarray(-32768);this.b.set(n,32768-n.length),this.s.i=32768-n.length}}return t.prototype.p=function(e,r){this.ondata(He(e,this.o,0,0,this.s),r)},t.prototype.push=function(e,r){this.ondata||P(5),this.s.l&&P(4);var n=e.length+this.s.z;if(n>this.b.length){if(n>2*this.b.length-32768){var a=new $(n&-32768);a.set(this.b.subarray(0,this.s.z)),this.b=a}var o=this.b.length-this.s.z;o&&(this.b.set(e.subarray(0,o),this.s.z),this.s.z=this.b.length,this.p(this.b,!1)),this.b.set(this.b.subarray(-32768)),this.b.set(e.subarray(o),32768),this.s.z=e.length-o+32768,this.s.i=32766,this.s.w=32768}else this.b.set(e,this.s.z),this.s.z+=e.length;this.s.l=r&1,(this.s.z>this.s.w+8191||r)&&(this.p(this.b,r||!1),this.s.w=this.s.i,this.s.i-=2)},t}(),kt=function(){function t(e,r){Dt([At,function(){return[tt,rt]}],this,Ct.call(this,e,r),function(n){var a=new rt(n.data);onmessage=tt(a)},6)}return t}();function zt(t,e){return He(t,e||{},0,0)}var nt=typeof TextEncoder<"u"&&new TextEncoder,Ft=typeof TextDecoder<"u"&&new TextDecoder,It=0;try{Ft.decode(Ie,{stream:!0}),It=1}catch{}function Pe(t,e){if(e){for(var r=new $(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}if(nt)return nt.encode(t);for(var a=t.length,o=new $(t.length+(t.length>>1)),s=0,l=function(u){o[s++]=u},n=0;n<a;++n){if(s+5>o.length){var c=new $(s+8+(a-n<<1));c.set(o),o=c}var i=t.charCodeAt(n);i<128||e?l(i):i<2048?(l(192|i>>6),l(128|i&63)):i>55295&&i<57344?(i=65536+(i&1047552)|t.charCodeAt(++n)&1023,l(240|i>>18),l(128|i>>12&63),l(128|i>>6&63),l(128|i&63)):(l(224|i>>12),l(128|i>>6&63),l(128|i&63))}return Ce(o,0,s)}var Ht=function(t){return t==1?3:t<6?2:t==9?1:0},Te=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;n>65535&&P(9),e+=n+4}return e},at=function(t,e,r,n,a,o,s,l){var c=n.length,i=r.extra,u=l&&l.length,p=Te(i);q(t,e,s!=null?33639248:67324752),e+=4,s!=null&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(o<0&&8),t[e++]=a&&8,t[e++]=r.compression&255,t[e++]=r.compression>>8;var v=new Date(r.mtime==null?Date.now():r.mtime),y=v.getFullYear()-1980;if((y<0||y>119)&&P(10),q(t,e,y<<25|v.getMonth()+1<<21|v.getDate()<<16|v.getHours()<<11|v.getMinutes()<<5|v.getSeconds()>>1),e+=4,o!=-1&&(q(t,e,r.crc),q(t,e+4,o<0?-o-2:o),q(t,e+8,r.size)),q(t,e+12,c),q(t,e+14,p),e+=16,s!=null&&(q(t,e,u),q(t,e+6,r.attrs),q(t,e+10,s),e+=14),t.set(n,e),e+=c,p)for(var f in i){var d=i[f],m=d.length;q(t,e,+f),q(t,e+2,m),t.set(d,e+4),e+=4+m}return u&&(t.set(l,e),e+=u),e},Pt=function(t,e,r,n,a){q(t,e,101010256),q(t,e+8,r),q(t,e+10,r),q(t,e+12,n),q(t,e+16,a)},Oe=function(){function t(e){this.filename=e,this.c=Tt(),this.size=0,this.compression=0}return t.prototype.process=function(e,r){this.ondata(null,e,r)},t.prototype.push=function(e,r){this.ondata||P(5),this.c.p(e),this.size+=e.length,r&&(this.crc=this.c.d()),this.process(e,r||!1)},t}(),Ot=function(){function t(e,r){var n=this;r||(r={}),Oe.call(this,e),this.d=new kt(r,function(a,o,s){n.ondata(a,o,s)}),this.compression=8,this.flag=Ht(r.level),this.terminate=this.d.terminate}return t.prototype.process=function(e,r){this.d.push(e,r)},t.prototype.push=function(e,r){Oe.prototype.push.call(this,e,r)},t}(),jt=function(){function t(e){this.ondata=e,this.u=[],this.d=1}return t.prototype.add=function(e){var r=this;if(this.ondata||P(5),this.d&2)this.ondata(P(4+(this.d&1)*8,0,1),null,!1);else{var n=Pe(e.filename),a=n.length,o=e.comment,s=o&&Pe(o),l=a!=e.filename.length||s&&o.length!=s.length,c=a+Te(e.extra)+30;a>65535&&this.ondata(P(11,0,1),null,!1);var i=new $(c);at(i,0,e,n,l,-1);var u=[i],p=function(){for(var m=0,g=u;m<g.length;m++){var A=g[m];r.ondata(null,A,!1)}u=[]},v=this.d;this.d=0;var y=this.u.length,f=_e(e,{f:n,u:l,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(p(),v){var m=r.u[y+1];m?m.r():r.d=1}v=1}}),d=0;e.ondata=function(m,g,A){if(m)r.ondata(m,g,A),r.terminate();else if(d+=g.length,u.push(g),A){var b=new $(16);q(b,0,134695760),q(b,4,e.crc),q(b,8,d),q(b,12,e.size),u.push(b),f.c=d,f.b=c+d+16,f.crc=e.crc,f.size=e.size,v&&f.r(),v=1}else v&&p()},this.u.push(f)}},t.prototype.end=function(){var e=this;if(this.d&2){this.ondata(P(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){e.d&1&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var e=0,r=0,n=0,a=0,o=this.u;a<o.length;a++){var s=o[a];n+=46+s.f.length+Te(s.extra)+(s.o?s.o.length:0)}for(var l=new $(n+22),c=0,i=this.u;c<i.length;c++){var s=i[c];at(l,e,s,s.f,s.u,-s.c-2,r,s.o),e+=46+s.f.length+Te(s.extra)+(s.o?s.o.length:0),r+=s.b}Pt(l,e,this.u.length,n,r),this.ondata(null,l,!0),this.d=2},t.prototype.terminate=function(){for(var e=0,r=this.u;e<r.length;e++){var n=r[e];n.t()}this.d=2},t}();class Ut{constructor(e){Ze(this,"value");Ze(this,"next");this.value=e}}class Bt{constructor(){qe(this,N,void 0);qe(this,ee,void 0);qe(this,te,void 0);this.clear()}enqueue(e){const r=new Ut(e);X(this,N)?(X(this,ee).next=r,V(this,ee,r)):(V(this,N,r),V(this,ee,r)),Je(this,te)._++}dequeue(){const e=X(this,N);if(e)return V(this,N,X(this,N).next),Je(this,te)._--,e.value}clear(){V(this,N,void 0),V(this,ee,void 0),V(this,te,0)}get size(){return X(this,te)}*[Symbol.iterator](){let e=X(this,N);for(;e;)yield e.value,e=e.next}}N=new WeakMap,ee=new WeakMap,te=new WeakMap;const Nt={bind(t,e,r){return t.bind(r)}};function Wt(t){if(!((Number.isInteger(t)||t===Number.POSITIVE_INFINITY)&&t>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const e=new Bt;let r=0;const n=()=>{r--,e.size>0&&e.dequeue()()},a=async(l,c,i)=>{r++;const u=(async()=>l(...i))();c(u);try{await u}catch{}n()},o=(l,c,i)=>{e.enqueue(Nt.bind(a.bind(void 0,l,c,i))),(async()=>(await Promise.resolve(),r<t&&e.size>0&&e.dequeue()()))()},s=(l,...c)=>new Promise(i=>{o(l,i,c)});return Object.defineProperties(s,{activeCount:{get:()=>r},pendingCount:{get:()=>e.size},clearQueue:{value(){e.clear()}}}),s}var ot={exports:{}};/*! streamsaver. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */(function(t){((e,r)=>{t.exports=r()})("streamSaver",()=>{const e=typeof window=="object"?window:this;e.HTMLElement||console.warn("streamsaver is meant to run on browsers main thread");let r=null,n=!1;const a=f=>{try{f()}catch{}},o=e.WebStreamsPolyfill||{},s=e.isSecureContext;let l=/constructor/i.test(e.HTMLElement)||!!e.safari||!!e.WebKitPoint;const c=s||"MozAppearance"in document.documentElement.style?"iframe":"navigate",i={createWriteStream:y,WritableStream:e.WritableStream||o.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function u(f){if(!f)throw new Error("meh");const d=document.createElement("iframe");return d.hidden=!0,d.src=f,d.loaded=!1,d.name="iframe",d.isIframe=!0,d.postMessage=(...m)=>d.contentWindow.postMessage(...m),d.addEventListener("load",()=>{d.loaded=!0},{once:!0}),document.body.appendChild(d),d}function p(f){const d="width=200,height=100",m=document.createDocumentFragment(),g={frame:e.open(f,"popup",d),loaded:!1,isIframe:!1,isPopup:!0,remove(){g.frame.close()},addEventListener(...b){m.addEventListener(...b)},dispatchEvent(...b){m.dispatchEvent(...b)},removeEventListener(...b){m.removeEventListener(...b)},postMessage(...b){g.frame.postMessage(...b)}},A=b=>{b.source===g.frame&&(g.loaded=!0,e.removeEventListener("message",A),g.dispatchEvent(new Event("load")))};return e.addEventListener("message",A),g}try{new Response(new ReadableStream),s&&!("serviceWorker"in navigator)&&(l=!0)}catch{l=!0}a(()=>{const{readable:f}=new TransformStream,d=new MessageChannel;d.port1.postMessage(f,[f]),d.port1.close(),d.port2.close(),n=!0,Object.defineProperty(i,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})});function v(){r||(r=s?u(i.mitm):p(i.mitm))}function y(f,d,m){let g={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},A=0,b=null,M=null,D=null;if(Number.isFinite(d)?([m,d]=[d,m],console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),g.size=m,g.writableStrategy=d):d&&d.highWaterMark?(console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),g.size=m,g.writableStrategy=d):g=d||{},!l){v(),M=new MessageChannel,f=encodeURIComponent(f.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const T={transferringReadable:n,pathname:g.pathname||Math.random().toString().slice(-6)+"/"+f,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+f}};g.size&&(T.headers["Content-Length"]=g.size);const w=[T,"*",[M.port2]];if(n){const h=c==="iframe"?void 0:{transform(W,I){if(!(W instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");A+=W.length,I.enqueue(W),b&&(location.href=b,b=null)},flush(){b&&(location.href=b)}};D=new i.TransformStream(h,g.writableStrategy,g.readableStrategy);const z=D.readable;M.port1.postMessage({readableStream:z},[z])}M.port1.onmessage=h=>{h.data.download?c==="navigate"?(r.remove(),r=null,A?location.href=h.data.download:b=h.data.download):(r.isPopup&&(r.remove(),r=null,c==="iframe"&&u(i.mitm)),u(h.data.download)):h.data.abort&&(k=[],M.port1.postMessage("abort"),M.port1.onmessage=null,M.port1.close(),M.port2.close(),M=null)},r.loaded?r.postMessage(...w):r.addEventListener("load",()=>{r.postMessage(...w)},{once:!0})}let k=[];return!l&&D&&D.writable||new i.WritableStream({write(T){if(!(T instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");if(l){k.push(T);return}M.port1.postMessage(T),A+=T.length,b&&(location.href=b,b=null)},close(){if(l){const T=new Blob(k,{type:"application/octet-stream; charset=utf-8"}),w=document.createElement("a");w.href=URL.createObjectURL(T),w.download=f,w.click()}else M.port1.postMessage("end")},abort(){k=[],M.port1.postMessage("abort"),M.port1.onmessage=null,M.port1.close(),M.port2.close(),M=null}},g.writableStrategy)}return i})})(ot);var Rt=ot.exports;const Zt=[2,3,5,7,11,13,17,19],Jt=Wt(4),Vt=({title:t,artists:e,magazines:r})=>{const n=[];return e&&(e.length===1?n.push(`[${e[0]}]`):e.length===2?n.push(`[${e[0]} & ${e[1]}]`):e.length>=3&&n.push("[Various]")),n.push(t),(r==null?void 0:r.length)===1&&n.push(`(${r[0]})`),n.join(" ").replace("＊","*").replace("？","?").replace("⁄","/").replace("Ꞓ",":")},Kt=t=>{const e=atob(t),r=e.length,n=new Uint8Array(r);for(let a=0;a<r;a++)n[a]=e.charCodeAt(a);return n},Qt=t=>{const e=Kt(t),r=e.slice(0,64).map(f=>f&255),n=e.slice(64).map(f=>f&255),a=[...Array(256).keys()];let o=0;for(let f=0;f<64;f++){o^=r[f];for(let d=0;d<8;d++)o=o&1?o>>>1^12:o>>>1}o&=7;let s,l=0;for(let f=0;f<256;f++)l=(l+a[f]+r[f%64])%256,s=a[f],a[f]=a[l],a[l]=s;const c=Zt[o];let i=0,u=0,p=0,v=0,y="";for(let f=0;f<n.length;f++)i=(i+c)%256,u=(p+a[(u+a[i])%256])%256,p=(p+i+a[i])%256,s=a[i],a[i]=a[u],a[u]=s,v=a[(u+a[(i+a[(v+p)%256])%256])%256],y+=String.fromCharCode(n[f]^v);return y},Yt=async(t,e)=>{const n=await(await fetch(t.image)).blob(),a=n.type.split("/").at(-1),o=new Oe(`${t.url_label}.${a}`);e.add(o),await n.arrayBuffer().then(s=>{o.push(new Uint8Array(s),!0)})},st=async(t,e,r)=>new Promise((n,a)=>{var p,v,y,f;const s=Rt.createWriteStream(`${Vt(t)}.cbz`).getWriter(),l=new jt;l.ondata=async(d,m,g)=>{d?(s.abort(),a(d)):(s.write(m),g&&s.close())};const c=new Ot("info.json");l.add(c),c.push(Pe(JSON.stringify({Title:t.title,Description:t.description,Artist:(p=t.artists)==null?void 0:p.join(", "),Groups:t.circles,Magazine:(v=t.magazines)==null?void 0:v.join(", "),Parody:(y=t.parodies)==null?void 0:y.join(", "),Publisher:(f=t.publishers)==null?void 0:f.join(", "),Pages:t.pages,Favorites:t.favorites,Tags:t.tags,Source:`https://hentainexus.com/view/${t.id}`},null,2)),!0);let i=0;Promise.all(e.map(d=>Jt(()=>Yt(d,l).then(()=>{i++,r(i)})))).then(()=>{l.end(),n()});const u=()=>s.abort();window.addEventListener("beforeunload",u),s.closed.then(()=>window.removeEventListener("beforeunload",u))}),it=async t=>{const e=await fetch(`/read/${t}`);if(!e.ok)throw new Error(`[${e.status}] ${e.statusText} - Failed to get images for ${t}`);const r=await e.text(),n=new DOMParser().parseFromString(r,"text/html"),o=Array.from(n.querySelectorAll("script")).find(c=>c.innerHTML.includes("initReader")).innerHTML.match(/initReader\("([^"]*)"/)[1],s=JSON.parse(Qt(o)).filter(c=>c.type==="image");return localStorage.getItem("strip_filter")==="true"?s.map(c=>({...c,image:c.image.replace("?filter=null","")})):s},de='<svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" viewBox="0 0 24 24"><path fill="currentColor" d="M5 21v-1h14v1zm6.98-3.77L6.366 9.789h3.27V3h4.711v6.788h3.27z"/></svg>',lt='<svg xmlns="http://www.w3.org/2000/svg" class="animate-spin" width="1.3rem" height="1.3rem" viewBox="0 0 24 24"><g fill="currentColor"><path fill-rule="evenodd" d="M12 19a7 7 0 1 0 0-14a7 7 0 0 0 0 14m0 3c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10" clip-rule="evenodd" opacity=".2"/><path d="M2 12C2 6.477 6.477 2 12 2v3a7 7 0 0 0-7 7z"/></g></svg>',ct='<svg xmlns="http://www.w3.org/2000/svg" width="1.3rem" height="1.3rem" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M3.47 3.47a.75.75 0 0 1 1.06 0L8 6.94l3.47-3.47a.75.75 0 1 1 1.06 1.06L9.06 8l3.47 3.47a.75.75 0 1 1-1.06 1.06L8 9.06l-3.47 3.47a.75.75 0 0 1-1.06-1.06L6.94 8L3.47 4.53a.75.75 0 0 1 0-1.06" clip-rule="evenodd"/></svg>';function je(){}function Gt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}const se=[];function ut(t,e=je){let r;const n=new Set;function a(l){if(Gt(t,l)&&(t=l,r)){const c=!se.length;for(const i of n)i[1](),se.push(i,t);if(c){for(let i=0;i<se.length;i+=2)se[i][0](se[i+1]);se.length=0}}}function o(l){a(l(t))}function s(l,c=je){const i=[l,c];return n.add(i),n.size===1&&(r=e(a,o)||je),l(t),()=>{n.delete(i),n.size===0&&r&&(r(),r=null)}}return{set:a,update:o,subscribe:s}}const ie=(()=>{const t=JSON.parse(localStorage.getItem("downloads")||"[]"),{set:e,subscribe:r}=ut(t);return{get:()=>t,add:s=>{t.includes(s)||t.push(s),e(t),localStorage.setItem("downloads",JSON.stringify(t))},includes:s=>t.includes(s),subscribe:r}})(),he=t=>Number(t.querySelector("a").getAttribute("href").split("/").at(-1)),Xt=t=>{const e=({id:s,title:l})=>{const c=t.find(i=>s===he(i));if(c){const i=c.querySelector('button[role="download"]');i.setAttribute("state","processing"),i.classList.add("disabled"),i.classList.remove("downloaded","failed"),i.innerHTML=lt,console.log(`Started download for (${s}) '${l}'`)}},r=({id:s},l,c)=>{const i=t.find(u=>s===he(u));if(i){const u=i.querySelector(`span[download="${s}"]`);u.innerHTML=`${l}/${c}`}},n=({id:s,title:l})=>{const c=t.find(i=>s===he(i));if(c){const i=c.querySelector('button[role="download"]');i.innerHTML=de,console.log(`Finished download for (${s}) '${l}'`),o(s)}},a=({id:s,title:l},c)=>{const i=t.find(u=>s===he(u));if(i){const u=i.querySelector('button[role="download"]');u.classList.add("failed"),u.innerHTML=ct,console.error(`Failed download for (${s}) '${l}'`,c),o(s)}},o=s=>{const l=t.find(u=>s===he(u)),c=l.querySelector('button[role="download"]');c.setAttribute("state","idle"),c.classList.remove("disabled");const i=l.querySelector(`span[download="${s}"]`);i.innerHTML=""};return{start:e,progress:r,finish:n,fail:a}},ft=()=>{const{update:t,subscribe:e}=ut({kind:"idle"});return{idle:()=>{t(l=>({...l,kind:"idle"}))},starting:()=>{t(l=>({...l,kind:"starting"}))},processing:(l,c)=>{t(i=>({...i,kind:"processing",progress:l,total:c}))},success:(l,c)=>{t(i=>({...i,kind:"success",progress:l,total:c}))},fail:()=>{t(l=>({...l,kind:"failed"}))},subscribe:e}},dt=t=>new Promise(e=>setTimeout(e,t)),ve=ft(),Ee=Array.from(document.querySelectorAll(".column")),Y=Xt(Ee),_t=()=>{const t=document.createElement("button");return t.innerHTML="Download all",t.classList.add("button","pagination-next","download-header"),ve.subscribe(e=>{switch(e.kind){case"idle":t.innerHTML="Download all",t.classList.remove("disabled");break;case"processing":t.innerHTML=`(${e.progress}/${e.total}) Downloading`,t.classList.add("disabled");break;case"success":t.innerHTML=`(${e.progress}/${e.total}) Download finished`,t.classList.add("disabled");break}}),t},ht=async t=>{const e=await re(t.id),r=await it(t.id);Y.progress(t,0,r.length),await st(e,r,n=>Y.progress(t,n,r.length))},er=async()=>{let t=Ee.map(r=>({id:Number(r.querySelector("a").getAttribute("href").split("/").at(-1)),title:r.querySelector(".card-header").getAttribute("title")}));localStorage.getItem("skip_download")==="true"&&(t=t.filter(r=>!ie.includes(r.id)));let e=0;for(const r of t)ve.processing(e,t.length),Y.start(r),await ht(r).then(()=>{e++,ve.processing(e,t.length),Y.finish(r),ie.add(r.id)}).catch(n=>{Y.fail(r,n)});ve.success(e,t.length),await dt(2500),ve.idle()},tr=()=>{const t=document.querySelector(".search-title"),e=_t();if(e.addEventListener("click",er),t){const r=t.parentElement;r.classList.add("flex","space-between"),r.append(e)}else{e.classList.add("ms-auto");const r=document.createElement("div");r.classList.add("container","flex","mb-6"),r.append(e);const n=document.querySelector(".container");n.parentElement.insertBefore(r,n)}},rr=()=>{for(const t of Ee){const e=Number(t.querySelector("a").getAttribute("href").split("/").at(-1)),r=t.querySelector(".card-header").getAttribute("title"),n=document.createElement("button");n.id=`download-${e}`,n.role="download",n.title=`Download '${r}'`,n.innerHTML=de,n.classList.add("button","grey","download-icon"),ie.includes(e)&&n.classList.add("downloaded"),n.addEventListener("click",s=>{s.preventDefault();const l={id:e,title:r};Y.start(l),ht(l).then(()=>{Y.finish(l),ie.add(e)}).catch(c=>{Y.fail(l,c)})});const a=document.createElement("span");a.classList.add("progress-text"),a.setAttribute("download",e.toString());const o=t.querySelector(".card-header");o.classList.add("flex","items-center"),o.appendChild(a),o.appendChild(n)}},nr=Object.freeze(Object.defineProperty({__proto__:null,init:()=>{tr(),rr(),ie.subscribe(t=>{Ee.forEach(e=>{const r=e.querySelector('button[role="download"');if(r.getAttribute("state")!=="idle")return;const a=Number(r.getAttribute("id").replace("download-",""));t.includes(a)?r.classList.add("downloaded"):r.classList.remove("downloaded")})})}},Symbol.toStringTag,{value:"Module"})),_=ft(),Ue=E(document),ar=async t=>{t.preventDefault();try{_.starting();const e=await it(Ue.id);_.processing(0,e.length);let r=0;await st(Ue,e,n=>{r=n,_.processing(n,e.length)}),_.success(r,e.length)}catch(e){_.fail(),console.error("Failed to download gallery",e)}};function or(){const t=document.querySelector(".level-left > .level-item"),e=t.cloneNode(!0);e.querySelector("a").removeAttribute("href"),e.querySelector(".icon").innerHTML=de,e.querySelector(".button-label").innerHTML="Download",e.addEventListener("click",ar),t.after(e),_.subscribe(async r=>{switch(r.kind){case"idle":e.classList.remove("disabled"),e.querySelector(".icon").innerHTML=de,e.querySelector(".button-label").innerHTML="Download";break;case"starting":e.classList.add("disabled"),e.querySelector(".icon").innerHTML=lt,e.querySelector(".button-label").innerHTML="Downloading";break;case"processing":e.classList.add("disabled"),e.querySelector(".button-label").innerHTML=`Downloading (${r.progress}/${r.total})`;break;case"failed":e.classList.remove("disabled"),e.querySelector(".icon").innerHTML=ct,e.querySelector(".button-label").innerHTML="Download Failed";break;case"success":e.querySelector(".icon").innerHTML=de,e.classList.add("disabled"),e.querySelector(".button-label").innerHTML=`Downloaded (${r.progress}/${r.total})`,ie.add(Ue.id),await dt(1500),_.idle();break}})}const sr=Object.freeze(Object.defineProperty({__proto__:null,init:()=>{or()}},Symbol.toStringTag,{value:"Module"})),vt=({name:t,description:e,value:r})=>{const n=document.createElement("div");n.classList.add("field");const a=document.createElement("input");a.id=t,a.name=t,a.style.marginRight="0.5rem",a.type="checkbox",a.checked=r;const o=document.createElement("label");return o.htmlFor=t,o.innerHTML=e,n.append(a,o),n},ir=()=>{const t=document.querySelector(".container"),e=document.createElement("hr"),r=document.createElement("h4");r.classList.add("title","is-4"),r.innerHTML="Script settings";const n=document.createElement("form");n.onsubmit=()=>{const p=new FormData(n),v=Object.fromEntries(p);localStorage.setItem("skip_download",v.skip_download?"true":"false"),localStorage.setItem("strip_filter",v.strip_filter?"true":"false"),location.reload()};const a=localStorage.getItem("skip_download"),o=localStorage.getItem("strip_filter"),s=vt({name:"skip_download",description:"Skip downloaded galleries from batch downloads.",value:a==="true"}),l=vt({name:"strip_filter",description:"Avoid striping '?filter=null' from the image URL. Enable this if downloads fail or are incomplete.",value:o==="true"});n.append(s,l);const c=document.createElement("div");c.classList.add("filter"),c.innerHTML='<div class="control"><button class="button is-primary">Submit</button></div>',n.append(c);const i=document.createElement("div");i.classList.add("columns");const u=document.createElement("div");u.classList.add("column"),u.append(n),i.append(u),t.append(e),t.append(r),t.append(i)},lr=Object.freeze(Object.defineProperty({__proto__:null,init:()=>{ir()}},Symbol.toStringTag,{value:"Module"}))});
